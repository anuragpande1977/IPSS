<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IPSS Questionnaire – Quick Q&A</title>
  <style>
    :root{
      --bg:#0b1320; --card:#121a2b; --ink:#eaf0ff; --muted:#a9b4d9; --accent:#5dd1ff; --ok:#30d158; --warn:#ffd60a; --bad:#ff453a;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#0b1320,#0d1630); color:var(--ink);}
    .wrap{max-width:940px; margin:0 auto; padding:24px}
    .card{background:var(--card); border:1px solid #1b2742; border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{font-weight:700; letter-spacing:.2px; font-size:28px; margin:0 0 6px}
    h2{font-size:20px; margin:18px 0 10px}
    p{color:var(--muted); line-height:1.55}
    .grid{display:grid; gap:14px}
    .teaser{display:grid; gap:8px; grid-template-columns:1fr 1fr; margin:16px 0}
    .teaser button{background:#172241; border:1px solid #26345d; color:var(--ink); padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:600}
    .teaser button:hover{border-color:#3b538f}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; background:#172241; border:1px solid #28406e; color:var(--muted)}
    .q{margin:10px 0 4px; font-weight:600}
    fieldset{border:none; padding:0; margin:0 0 12px}
    .options{display:grid; gap:8px; grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    label.opt{display:flex; align-items:center; gap:10px; background:#111a2d; border:1px solid #21325a; padding:10px 12px; border-radius:12px; cursor:pointer}
    input[type="radio"]{accent-color:var(--accent)}
    .row{display:grid; grid-template-columns:1fr; gap:12px}
    .cta{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{background:var(--accent); color:#061024; border:none; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer}
    .btn.alt{background:#172241; border:1px solid #2a3e6f; color:var(--ink)}
    .hide{display:none}
    .note{font-size:12px; color:var(--muted)}
    .result{margin-top:14px; padding:14px; border-radius:12px; border:1px dashed #36538d; background:#0f1930}
    .badge{font-weight:800; padding:4px 8px; border-radius:999px; font-size:12px}
    .mild{background:rgba(48,209,88,.15); color:var(--ok); border:1px solid rgba(48,209,88,.35)}
    .moderate{background:rgba(255,214,10,.12); color:var(--warn); border:1px solid rgba(255,214,10,.42)}
    .severe{background:rgba(255,69,58,.12); color:var(--bad); border:1px solid rgba(255,69,58,.42)}
    .hr{height:1px; background:#223258; margin:14px 0}
    .footer{margin-top:24px; font-size:12px; color:var(--muted)}
    a{color:var(--accent)}
    .hdr{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hdr">
        <h1>Quick Q&A → IPSS Symptom Score</h1>
        <span class="pill">Educational • 3–4 minutes • Email optional</span>
      </div>
      <p><strong>How it works:</strong> Answer three quick Yes/No prompts, then complete the 7-question IPSS to see your <em>mild / moderate / severe</em> category. Educational only, not medical advice.</p>

      <!-- Curiosity Teasers -->
      <h2>Step 1 — Three quick Yes/No prompts</h2>
      <div id="teasers" class="grid">
        <div class="card" style="background:#0d1730; border-color:#23335b;">
          <div class="q">1) Do you ever wake up ≥2 times/night to urinate?</div>
          <div class="teaser">
            <button data-teaser="t1" data-val="yes">Yes</button>
            <button data-teaser="t1" data-val="no">No</button>
          </div>
          <div id="a-t1" class="hide"><span class="pill">Answer</span>
            <p>Waking ≥2× may suggest nighttime symptoms (nocturia). Let’s check your full IPSS to understand severity.</p>
          </div>
        </div>
        <div class="card" style="background:#0d1730; border-color:#23335b;">
          <div class="q">2) Do you sometimes feel an urgent need to rush to the bathroom?</div>
          <div class="teaser">
            <button data-teaser="t2" data-val="yes">Yes</button>
            <button data-teaser="t2" data-val="no">No</button>
          </div>
          <div id="a-t2" class="hide"><span class="pill">Answer</span>
            <p>Urgency can be part of lower urinary tract symptoms. The IPSS helps quantify patterns.</p>
          </div>
        </div>
        <div class="card" style="background:#0d1730; border-color:#23335b;">
          <div class="q">3) Do you sometimes feel you haven't fully emptied your bladder?</div>
          <div class="teaser">
            <button data-teaser="t3" data-val="yes">Yes</button>
            <button data-teaser="t3" data-val="no">No</button>
          </div>
          <div id="a-t3" class="hide"><span class="pill">Answer</span>
            <p>That “incomplete emptying” feeling is one of the IPSS items. Let’s measure it accurately.</p>
          </div>
        </div>
      </div>

      <div class="cta">
        <button id="startIpSS" class="btn">Continue to IPSS</button>
        <button id="skipToIpSS" class="btn alt">Skip teasers → IPSS</button>
      </div>

      <div class="hr"></div>

      <!-- IPSS Form -->
      <div id="ipssSection" class="hide">
        <h2>Step 2 — IPSS (International Prostate Symptom Score)</h2>
        <p>For each question, choose the option that best describes the last month. Scores: 0 (Never) to 5 (Almost always).</p>

        <form id="ipssForm">
          <div id="ipssQuestions"></div>

          <h2>Quality of Life (Bother) Question</h2>
          <p>If you were to spend the rest of your life with your urinary condition just the way it is now, how would you feel about that?</p>
          <fieldset>
            <div class="options">
              <label class="opt"><input type="radio" name="qol" value="0" required/> Delighted (0)</label>
              <label class="opt"><input type="radio" name="qol" value="1"/> Pleased (1)</label>
              <label class="opt"><input type="radio" name="qol" value="2"/> Mostly satisfied (2)</label>
              <label class="opt"><input type="radio" name="qol" value="3"/> Mixed (3)</label>
              <label class="opt"><input type="radio" name="qol" value="4"/> Mostly dissatisfied (4)</label>
              <label class="opt"><input type="radio" name="qol" value="5"/> Unhappy (5)</label>
              <label class="opt"><input type="radio" name="qol" value="6"/> Terrible (6)</label>
            </div>
          </fieldset>

          <div class="cta">
            <button type="submit" class="btn">See my score</button>
            <button type="reset" id="resetBtn" class="btn alt">Reset</button>
          </div>
        </form>

        <div id="result" class="result hide"></div>

        <div id="lead" class="hide">
          <div class="hr"></div>
          <h2>Get your score by email (optional)</h2>
          <p>Enter your email to receive a copy of your IPSS result and occasional educational updates. No other data collected.</p>
          <form id="leadForm">
            <div class="row">
              <input type="email" id="email" placeholder="Email (required to receive your result)" required
                     style="padding:12px; border-radius:10px; border:1px solid #27406f; background:#0f1830; color:var(--ink)"/>
            </div>
            <label style="display:flex; gap:8px; align-items:flex-start; margin-top:10px; font-size:12px; color:var(--muted)">
              <input type="checkbox" id="consent" required/> I agree to receive my result and educational messages about urinary health (opt out anytime).
            </label>
            <div class="cta">
              <button type="submit" class="btn">Email me my result</button>
            </div>
            <p class="note">Privacy: Only your email is submitted. If you prefer not to share it, you can simply view your score above.</p>
          </form>
        </div>

        <div class="footer">
          <p><strong>Disclaimer:</strong> This tool is for education only and does not diagnose, treat, or replace professional medical advice.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Curiosity mechanic for teasers ======
    document.querySelectorAll('.teaser button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const t = btn.getAttribute('data-teaser');
        document.getElementById('a-'+t).classList.remove('hide');
      });
    });
    document.getElementById('startIpSS').addEventListener('click', ()=>{
      document.getElementById('ipssSection').classList.remove('hide');
      window.scrollTo({top:document.getElementById('ipssSection').offsetTop-10, behavior:'smooth'});
    });
    document.getElementById('skipToIpSS').addEventListener('click', ()=>{
      document.getElementById('ipssSection').classList.remove('hide');
      window.scrollTo({top:document.getElementById('ipssSection').offsetTop-10, behavior:'smooth'});
    });

    // ====== Build IPSS questions ======
    const ipssItems = [
      {key:'q1', text:'Incomplete emptying: How often have you had a sensation of not emptying your bladder completely after you finished urinating?'},
      {key:'q2', text:'Frequency: How often have you had to urinate again less than two hours after you last finished urinating?'},
      {key:'q3', text:'Intermittency: How often have you found you stopped and started again several times when you urinated?'},
      {key:'q4', text:'Urgency: How often have you found it difficult to postpone urination?'},
      {key:'q5', text:'Weak stream: How often have you had a weak urinary stream?'},
      {key:'q6', text:'Straining: How often have you had to push or strain to begin urination?'},
      {key:'q7', text:'Nocturia: How many times do you typically get up at night to urinate? (0 to 5+ times)'}
    ];
    const generic = [
      {v:0,l:'Never (0)'},
      {v:1,l:'Less than 1 in 5 times (1)'},
      {v:2,l:'Less than half the time (2)'},
      {v:3,l:'About half the time (3)'},
      {v:4,l:'More than half the time (4)'},
      {v:5,l:'Almost always (5)'}
    ];
    const nocturia = [
      {v:0,l:'0 times (0)'},
      {v:1,l:'1 time (1)'},
      {v:2,l:'2 times (2)'},
      {v:3,l:'3 times (3)'},
      {v:4,l:'4 times (4)'},
      {v:5,l:'5 or more times (5)'}
    ];
    const qWrap = document.getElementById('ipssQuestions');
    ipssItems.forEach((it, idx)=>{
      const fs = document.createElement('fieldset');
      const q = document.createElement('div');
      q.className = 'q';
      q.textContent = (idx+1)+') '+it.text;
      fs.appendChild(q);
      const opts = document.createElement('div');
      opts.className='options';
      const set = (it.key==='q7' ? nocturia : generic);
      set.forEach(c=>{
        const lab = document.createElement('label');
        lab.className = 'opt';
        lab.innerHTML = `<input type="radio" name="${it.key}" value="${c.v}" required/> ${c.l}`;
        opts.appendChild(lab);
      });
      fs.appendChild(opts);
      qWrap.appendChild(fs);
    });

    // ====== Calculate score & show ======
    let lastScore = null;
    let lastSeverity = null;
    const form = document.getElementById('ipssForm');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      let total = 0;
      for(let i=1;i<=7;i++){
        const sel = document.querySelector('input[name="q'+i+'"]:checked');
        if(!sel){ alert('Please answer question '+i); return; }
        total += parseInt(sel.value,10);
      }
      const qol = parseInt((document.querySelector('input[name="qol"]:checked')||{value:NaN}).value,10);
      const cat = total<=7 ? 'Mild' : (total<=19 ? 'Moderate' : 'Severe');
      const badgeClass = total<=7 ? 'mild' : (total<=19 ? 'moderate' : 'severe');
      lastScore = total; lastSeverity = cat;

      const guidance = total<=7
        ? 'Your symptoms are in the mild range.'
        : (total<=19 ? 'Your symptoms are in the moderate range.' : 'Your symptoms are in the severe range.');

      const res = document.getElementById('result');
      res.classList.remove('hide');
      res.innerHTML = `
        <div><span class="pill">Your IPSS</span></div>
        <h2 style="margin:8px 0 0">Total: <span class="badge ${badgeClass}">${total} / 35 • ${cat}</span></h2>
        <p style="margin:8px 0 12px">Quality-of-life (bother): <strong>${isNaN(qol)?'—':''+qol+' / 6'}</strong></p>
        <p>${guidance} This is for education only and not medical advice.</p>
      `;

      document.getElementById('lead').classList.remove('hide');
      window.scrollTo({top:res.offsetTop-10, behavior:'smooth'});
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      form.reset();
      document.getElementById('result').classList.add('hide');
      document.getElementById('lead').classList.add('hide');
      lastScore = null; lastSeverity = null;
    });

    // ====== Email-only capture to Google Apps Script ======
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbybQNdlEGIYavav9RQvVpkzZCA-FlG72sRjLHKWWlnPZm7MXTMbR4RgTyL_78IEL1tGwA/exec"; // <-- replace after deploy
    document.getElementById('leadForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = (document.getElementById('email').value||'').trim();
      const consent = document.getElementById('consent').checked;
      if(!email){ alert('Please enter your email.'); return; }
      if(!consent){ alert('Please tick consent.'); return; }

      // Only email is sent per your request.
      const payload = { email: email, source: "github" };

      try{
        await fetch(SCRIPT_URL, { method:'POST', mode:'no-cors', body: JSON.stringify(payload) });
        alert('Thanks! Your email has been recorded. Please check your inbox.');
      }catch(err){
        console.error(err);
        alert('Submitted (fallback). If you don’t receive an email, please try again later.');
      }
    });
  </script>
</body>
</html>
